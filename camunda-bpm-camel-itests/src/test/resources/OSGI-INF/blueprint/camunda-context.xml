<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:ext="http://aries.apache.org/blueprint/xmlns/blueprint-ext/v1.0.0">

  <ext:property-placeholder/>

  <bean id="blueprintELResolver"
        class="org.camunda.bpm.camel.blueprint.CamelBlueprintELResolver"/>

  <bean id="blueprintExpressionManager"
        class="org.camunda.bpm.extension.osgi.blueprint.BlueprintExpressionManager">
    <property name="blueprintELResolver" ref="blueprintELResolver"/>
  </bean>

  <bean id="processEngineFactory"
        class="org.camunda.bpm.extension.osgi.engine.ProcessEngineFactoryWithELResolver"
        init-method="init" destroy-method="destroy">
    <property name="processEngineConfiguration">
      <bean class="org.camunda.bpm.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration"/>
    </property>
    <property name="bundle" ref="blueprintBundle"/>
    <property name="expressionManager" ref="blueprintExpressionManager"/>
  </bean>

  <bean id="processEngine" factory-ref="processEngineFactory"
        factory-method="getObject" destroy-method="close"/>
  <!-- ############ Start BPM services ############ -->
  <bean id="runtimeService" factory-ref="processEngine"
        factory-method="getRuntimeService"/>
  <bean id="repositoryService" factory-ref="processEngine"
        factory-method="getRepositoryService"/>
  <bean id="formService" factory-ref="processEngine" factory-method="getFormService"/>
  <bean id="taskService" factory-ref="processEngine" factory-method="getTaskService"/>
  <bean id="historyService" factory-ref="processEngine"
        factory-method="getHistoryService"/>
  <bean id="identityService" factory-ref="processEngine"
        factory-method="getIdentityService"/>
  <bean id="managementService" factory-ref="processEngine"
        factory-method="getManagementService"/>

  <service ref="processEngine" interface="org.camunda.bpm.engine.ProcessEngine"/>
  <service ref="runtimeService" interface="org.camunda.bpm.engine.RuntimeService"/>
  <service ref="repositoryService" interface="org.camunda.bpm.engine.RepositoryService"/>
  <service ref="formService" interface="org.camunda.bpm.engine.FormService"/>
  <service ref="taskService" interface="org.camunda.bpm.engine.TaskService"/>
  <service ref="historyService" interface="org.camunda.bpm.engine.HistoryService"/>
  <service ref="identityService" interface="org.camunda.bpm.engine.IdentityService"/>
  <service ref="managementService" interface="org.camunda.bpm.engine.ManagementService"/>
  <!-- ############ End BPM services ############ -->

</blueprint>

